<!-- INSTRUCTION PAGE -->

<!-- LINK TO STYLESHEET-->
<link rel="stylesheet" href="{% static 'global/EcoLabels_visual/styling10.css' %}">

<!-- OTREE TEMPLATES -->
{% load otree static %}
{% block content %}

<body>

    <div class="flex-container">

        <h1> Instructions </h1>

        <!-- Slide 1-->
        <div class="mySlides">
            <div class="slide-item">
                <p class="title">General</p>
                <p>
                    This study uses Experimental Currency Units (ECU). One ECU is equivalent
                    to 2.5p (0.025 Pounds). You have received an initial Bonus Payment of 40 ECUs.
                    The Bonus Payment (40ECU) is used in this experiment as your "shopping" money. This amount
                    can <i>increase (or decrease)</i> depending on your decisions in this experiment. <u>The bonus
                        payment
                        is <i>additional</i> to your participation fee.</u>
                </p>
            </div>
        </div>

        <!-- Slide 2-->
        <div class="mySlides">
            <div class="slide-item">
                <p class="title">The experiment</p>
                <p>
                    In this experiment you will make a series of decisions between different products. There are x
                    amount of trials.
                    In each trial, you will be shown two products which differ from each other in terms of three
                    attributes:
                </p>
                
                    <p>1) Price, which is indicated with a number and a dollar sign,</p>
                    <p>2) Quality, which is indicated with a Star label, and</p>
                    <p>3) Sustainability, which is indicated with a Leaf label.</p>
                
                
            </div>
        </div>

        <!-- Slide 3-->
        <div class="mySlides">
            <div class="slide-item">
                <p class="title">The experiment</p>
                <p>
                    You can inspect these attributes by hovering your mouse over the labels.
                    Your task is to evaluate the products based on these attributes and choose the one you prefer the
                    most. The price of the product you chose will be subtracted from your Bonus Payment (40 ECUs).
                </p>
                <p>
                    Note! Each purchase is independent of the purchases in other trials, meaning that in each trial you
                    will have 40 ECUs to spend. At the end, one of the trials will be picked by random and the ECU's
                    left from that trial's purchase will constitute your Bonus Payment.
                </p>
            </div>
        </div>

        <!-- Slide 4 -->
        <div class="mySlides">
            <div class="slide-item">
                <p class="title">Example</p>
                <p>
                    You can inspect these attributes by hovering your mouse over the labels.
                    Your task is to evaluate the products based on these attributes and choose the one you prefer the
                    most. The price of the product you chose will be subtracted from your Bonus Payment (40 ECUs).
                </p>
                <p>
                    Note! Each purchase is independent of the purchases in other trials, meaning that in each trial you
                    will have 40 ECUs to spend. At the end, one of the trials will be picked by random and the ECU's
                    left from that trial's purchase will constitute your Bonus Payment.
                </p>
            </div>
        </div>

        <!-- Slide 5 -->
        <div class="mySlides">
            <div class="flex-questions">
                <p class="title">Please answer these questions to see whether you understood the instructions properly.</p>
                <li>
                    <!--Question 1-->
                    <div class="inst-question">
                        <label for="Q1">How many decisions do you have to make?</label>
                    </div>
                    <div class="answer-field">
                        <input type="text" name="Q1" id="Q1" class="inst-input">
                    </div>
                    <div class="hint" id="hint1">
                        Incorrect answer
                    </div>
                </li>
                <li>
                    <!--Question 2-->
                    <div class="inst-question">
                        <label for="Q2"> Are you a Wizard?
                        </label>
                    </div>
                    <div class="answer-field">
                        <label class="radio"> Yes
                            <input type="radio" name="Q2" id="Q2" class="Q-input" value="Yes">
                        </label>
                        <label class="radio"> No
                            <input type="radio" name="Q2" id="Q2" class="Q-input" value="No">
                        </label>
                    </div>
                    <div class="hint" id="hint2"> Incorrect answer<div>
                </li>
                <li>
                    <!--Question 3-->
                    <div class="inst-question">
                        <label for="Q3">Which object represents the eco-label?</label>
                    </div>
                    <div class="answer-field">
                        <select name="Q3" id="Q3" class="Q-input dropdown">
                            <option value="nothing">--Select--</option>
                            <option value="leaf">Leaf</option>
                            <option value="tree">Tree</option>
                            <option value="flower">Flower</option>
                        </select>
                    </div>
                    <div class="hint" id="hint3">
                        Incorrect answer
                        <div>
                </li>
                <li>
                    <!--Question 4-->
                    <div class="inst-question">
                        <label for="Q4"> How well did you understand the instructions?
                        </label>
                    </div>
                    <div class="answer-field">
                        <label class="radio"> Not at all
                            <input type="radio" name="Q4" id="Q4" class="Q-input" value=1>
                        </label>
                        <label class="radio">
                            <input type="radio" name="Q4" id="Q4" class="Q-input" value=2>
                        </label>
                        <label class="radio">
                            <input type="radio" name="Q4" id="Q4" class="Q-input" value=3>
                        </label>
                        <label class="radio">
                            <input type="radio" name="Q4" id="Q4" class="Q-input" value=4>
                        </label>
                        <label class="radio"> All clear
                            <input type="radio" name="Q4" id="Q4" class="Q-input" value=5>
                        </label>
                    </div>
                    <div class="hint" id="hint4">
                        Incorrect answer
                        <div>
                </li>
                <li>
                    <input class="submitButton" type="button" onclick=validateAnswers() value="Submit">
                </li>
            </div>
        </div>

        <!-- Next and previous buttons -->
        <a id="leftArrow" class="prev" onclick="plusSlides(-1)">&#10094;</a>
        <a id="rightArrow" class="next" onclick="plusSlides(1)">&#10095;</a>

        <!-- The dots/circles -->
        <div class="dot_row">
            <span class="dot" onclick="currentSlide(1)"></span>
            <span class="dot" onclick="currentSlide(2)"></span>
            <span class="dot" onclick="currentSlide(3)"></span>
            <span class="dot" onclick="currentSlide(4)"></span>
            <span class="dot" onclick="currentSlide(5)"></span>
        </div>

    </div>

    <div class="hideButton" id="nextButton"> {% next_button %} </div>
</body>

<!-- OTREE TEMPLATES -->

{% endblock %}


<!-- JAVASCRIPT -->

<script>

    // Initialize slide index //
    let slideIndex = 1;
    showSlides(slideIndex);


    // Next/previous controls
    function plusSlides(n) {
        showSlides(slideIndex += n);
    }

    // Thumbnail image controls
    function currentSlide(n) {
        showSlides(slideIndex = n);
    }

    // Next/previous keypress controls //
    document.addEventListener('keydown', (event) => {
        let keypress = event.key;
        if (keypress === 'ArrowLeft') {
            plusSlides(-1);
        } else if (keypress === 'ArrowRight') {
            plusSlides(1);
        }
    });


    // Slide switch function //
    function showSlides(n) {
        let i;
        let slides = document.getElementsByClassName("mySlides");
        let dots = document.getElementsByClassName("dot");
        let arrowLeft = document.querySelector("#leftArrow");
        let arrowRight = document.querySelector("#rightArrow");

        if (n > slides.length) { slideIndex = 1 }
        if (n < 1) { slideIndex = slides.length }
        for (i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";
        }
        for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(" active", "");
        }
        slides[slideIndex - 1].style.display = "block";
        dots[slideIndex - 1].className += " active";

        if (n === 1) {
            arrowLeft.style.display = "none" // make left arrow invisible on 1st slide
        } else if (n > 1) {
            arrowLeft.style.display = "block"
        }

        if (n === 5) {
            arrowRight.style.display = "none" // make right arrow invisible on 4th slide
        } else if (n < 5) {
            arrowRight.style.display = "block"
        }
    }

    // QUESTIONS SLIDE //

    // This function runs when "Submit" button is clicked. It compares all the inputs to question with solutions; if input is incorrect or empty, the function makes hint to that specific field visible. If the answer is correct, it adds + 1 to "correct"-array and makes hint invisible again. If all input are marked as correct, the oTree "Next" button will become visible. 

    function validateAnswers() {

        let solutions = ['50', 'Yes', 'leaf', '1']; // solutions
        let hints = document.getElementsByClassName("hint"); // make array of hints

        // get answer fields
        let A1 = document.getElementById("Q1");
        let A2 = document.querySelector('input[name="Q2"]:checked');
        let A3 = document.getElementById('Q3');
        let A4 = document.querySelector('input[name="Q4"]:checked');

        let answerList = [A1, A2, A3, A4];
        console.log(A1);
        console.log(A2);
        console.log(A3);
        console.log(A4);
        let correct = 0; // initialize counter for correct answers

        for (i = 0; i < answerList.length; i++) { // iterate through answers
            if (answerList[i] !== null) { // check for empty fields
                answerList[i] = answerList[i].value; // get value if not empty
            }
            if (answerList[i] !== solutions[i] || answerList[i] === null) {
                hints[i].style.visibility = "visible"; // incorrect or empty field: show hint
            } else {
                correct = correct + 1;
                hints[i].style.visibility = "hidden"; // correct: increase counter, hide hint

            }
        }
        if (correct === answerList.length) { // if all correct, show next button
            document.getElementById("nextButton").style.visibility = "visible";
        }

    }
</script>