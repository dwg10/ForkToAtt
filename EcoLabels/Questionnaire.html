{% load otree static %}
{% block content %}

<style>
    @import url(https://fonts.googleapis.com/css?family=Work+Sans:300,600);

    body {
        font-size: 20px;
        font-family: 'Work Sans', sans-serif;
        color: #333;
        font-weight: 300;
        text-align: center;
        background-color: #f8f6f0;
    }

    h1 {
        font-size: 1.2em;
        font-weight: 300;
        margin: 0px;
        padding: 5vh;
        background-color:white;
        color: #444;
    }

    .question {
        font-size: 1.2em;
        margin-bottom: 3vh;
    }

    .answers {
        margin-bottom: 20px;
        text-align: left;
        display: inline-block;
    }

    .answers label {
        display: block;
        margin-bottom: 10px;
    }

    .button {
        font-family: 'Work Sans', sans-serif;
        font-size: 22px;
        background-color: rgb(33, 202, 132);
        color: #fff;
        border: 0px;
        border-radius: 3px;
        padding: 4vh;
        cursor: pointer;
        margin-top: 15vh;
        text-decoration: none;
    }

    .button:hover {
        background-color: rgb(39, 221, 145);
        color: #fff;
    }

    .slide {
        position: absolute;
        left: 0px;
        top: 0px;
        width: 100%;
        z-index: 1;
        opacity: 0;
        transition: opacity 0.5s;
    }

    .active-slide {
        opacity: 1;
        z-index: 2;
    }

    .quiz-container {
        position: relative;
        height: 200px;
        margin-top: 40px;
    }

</style>

<body>

    <h1>As a final task we would like you to give your opinion on statements about sustainability. Please indicate your agreement or disagreement with the following statements by choosing the one of the answer options.</h1>

    <div class="quiz-container">
        <div id="quiz"></div>
    </div>
    <a id="previous" class="button" onclick=showPreviousSlide()>Previous</a>
    <a id="next" class="button" onclick=showNextSlide()> Next</a>
    <button id="submit" class="button" onclick=showResults()>Submit</button>

    <div id="otreeData"></div>


</body>
{% endblock %}

<!-- JAVASCRIPT -->

<script>

    (function () {
        // Functions
        function buildQuiz() {
            // variable to store the HTML output
            const output = [];

            // for each question...
            myQuestions.forEach(
                (currentQuestion, questionNumber) => {

                    // variable to store the list of possible answers
                    const answers = [];

                    // and for each available answer...

                        for (letter in currentQuestion.answers) {

                            // ...add an HTML radio button
                            answers.push(
                                `<label>
                      <input type="radio" class="demo-radio" name="question${questionNumber}" value="${letter}">             
                      ${currentQuestion.answers[letter]}
                    </label>`
                            );
                        }

                    // add this question and its answers to the output
                    output.push(
                        `<div class="slide">
                    <div class="question"> ${currentQuestion.question} </div>
                    <div class="answers"> ${answers.join("")} </div>
                  </div>`
                    );
                }
            );

            // finally combine our output list into one string of HTML and put it on the page
            quizContainer.innerHTML = output.join('');
        }

        function showResults() {

            // gather answer containers from our quiz
            const answerContainers = quizContainer.querySelectorAll('.answers');

            // for each question...
            myQuestions.forEach((currentQuestion, questionNumber) => {

                // find selected answer
                const answerContainer = answerContainers[questionNumber];
                const selector = `input[name=question${questionNumber}]:checked`;
                const userAnswer = (answerContainer.querySelector(selector) || {}).value;

                // save the user answers on oTree by creating hidden html with name that matches names in init
                let saveOtree = document.getElementById('otreeData');
                recordAnswer.push(
                    `<input type="hidden" name="D${questionNumber}" value="${userAnswer}">`
                );
                saveOtree.innerHTML = recordAnswer.join('');
            });
        }

        // Question slides: show one by one
        function showSlide(n) {
            slides[currentSlide].classList.remove('active-slide');
            slides[n].classList.add('active-slide');
            currentSlide = n;
            if (currentSlide === 0) {
                previousButton.style.display = 'none';
            }
            else {
                previousButton.style.display = 'inline-block';
            }
            if (currentSlide === slides.length - 1) {
                nextButton.style.display = 'none';
                submitButton.style.display = 'inline-block';
            }
            else {
                nextButton.style.display = 'inline-block';
                submitButton.style.display = 'none';
            }
        }

        function showNextSlide() {
            showSlide(currentSlide + 1);
        }

        function showPreviousSlide() {
            showSlide(currentSlide - 1);
        }

        // Variables
        const quizContainer = document.getElementById('quiz');
        const resultsContainer = document.getElementById('results');
        const submitButton = document.getElementById('submit');
        const myQuestions = [
            {
                question: "Reducing water consumption is necessary for sustainable development.",
                answers: {
                    a: "Strongly disagree",
                    b: "Disagree",
                    c: "Neutral",
                    d: "Agree",
                    e: "Strongly agree"
                },
            },
            {
                question: "Preserving the variety of living creatures is necessary for sustainable development (preserving biological diversity).",
                answers: {
                    a: "Strongly disagree",
                    b: "Disagree",
                    c: "Neutral",
                    d: "Agree",
                    e: "Strongly agree"
                },
            },
            {
                question: "For sustainable development, people need to be educated in how to protect themselves against natural disasters.",
                answers: {
                    a: "Strongly disagree",
                    b: "Disagree",
                    c: "Neutral",
                    d: "Agree",
                    e: "Strongly agree"
                },
            },
            {
                question: "A culture where conflicts are resolved peacefully through discussion is necessary for sustainable development.",
                answers: {
                    a: "Strongly disagree",
                    b: "Disagree",
                    c: "Neutral",
                    d: "Agree",
                    e: "Strongly agree"
                },
            },
            {
                question: "Respecting human rights is necessary for sustainable development.",
                answers: {
                    a: "Strongly disagree",
                    b: "Disagree",
                    c: "Neutral",
                    d: "Agree",
                    e: "Strongly agree"
                },
            },
            {
                question: "To achieve sustainable development, all the people in the world must have access to good education.",
                answers: {
                    a: "Strongly disagree",
                    b: "Disagree",
                    c: "Neutral",
                    d: "Agree",
                    e: "Strongly agree"
                },
            },
            {
                question: "Sustainable development requires that companies act responsibly towards their employees, customers and suppliers.",
                answers: {
                    a: "Strongly disagree",
                    b: "Disagree",
                    c: "Neutral",
                    d: "Agree",
                    e: "Strongly agree"
                },
            },
        ];

        // Kick things off
        buildQuiz();

        // Pagination
        const previousButton = document.getElementById("previous");
        const nextButton = document.getElementById("next");
        const slides = document.querySelectorAll(".slide");
        let currentSlide = 0;

        // Show the first slide
        showSlide(currentSlide);

        // Event listeners
        submitButton.addEventListener('click', showResults);
        previousButton.addEventListener("click", showPreviousSlide);
        nextButton.addEventListener("click", showNextSlide);

        // array for saving the html with correct 
        let recordAnswer = []
        console.log(recordAnswer);
    })();



</script>