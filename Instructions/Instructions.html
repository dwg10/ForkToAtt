<!-- INSTRUCTION PAGE -->

<!-- LINK TO STYLESHEET-->
<link rel="stylesheet" href="{% static 'global/styling10.css' %}">

<!-- Link to JS -->
<script src="{% static 'global/VT_functionality.js' %}"></script>


<!-- Set viewport -->
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- oTree templates -->
{% load otree static %}
{% block content %}

<body>

    <!-- Slide container-->
    <div class="flex-container">

        <!-- Title -->
        <h1> Instructions </h1>

        <!-- Slide 1-->

        <!-- Hide slide by default-->
        <div class="mySlides">

            <!-- Style slide items-->
            <div class="slide-item">

                <!-- Slide title -->
                <p class="title"> The Experiment </p>

                <!-- Slide text -->
                <p>
                    In this study you will make purchasing decisions. The products that you will observe are
                    <b>artificial</b>. There is no
                    physical product, but your <u>decisions</u> will have <b>real consequences.</b>
                    <br><br>
                    Depending on your <u>decisions</u> you can obtain an
                    additional <b>bonus payment up to €XX</b>. Also, depending your decisions you can help the
                    environment by <b>planting trees in the
                        Amazon</b>.
                </p>
            </div>
        </div>

        <!-- Slide 2-->
        <div class="mySlides">
            <div class="slide-item">
                <p class="title">The Benefits</p>
                <p>
                    In this experiment you will make multiple rounds <b>(NNN)</b> of a purchasing decision. In each
                    round you
                    will see <b>two products</b>. These products are not real, but their benefits are. Products can
                    grant you two benefits:
                    <br><br>
                    <b>1) Bonus Payment:</b> The products will have a level of <b>‘Quality’</b>. Products with <b>higher
                        quality</b>, will
                    lead to <b>higher bonus
                        payments.</b>
                    <br><br>
                    <b>2) Planting trees in the Amazon:</b> The products will have a level of <b>‘Sustainability’</b>.
                    Products with
                    <b>higher
                        sustainability</b>, will lead to <b>more trees planted in the Amazon.</b>
                </p>
            </div>
        </div>

        <!-- Slide 3-->
        <div class="mySlides">
            <div class="slide-item">
                <p class="title">The Cost</p>
                <p>
                    You need to choose one of the <b>two products</b> to <u>purchase.</u> By the end of the experiment, we will
                    <b>randomly select one of the rounds</b> and you will obtain the benefits of your purchased product in that round.
                    <br><br> The <b>cost
                        of the product</b> will be subtracted from your <b>bonus payment.</b> The cost will never be higher than the benefit, so do not
                    worry,
                    you will never lose
                    anything.
                </p>
            </div>
        </div>

        <!-- Slide 4-->
        <div class="mySlides">
            <div class="slide-item">
                <p class="title">The Product characteristics</p>
                <p>
                    In each round, we will show you the two products and their characteristics:
                </p>
                <p>
                    <b>Price:</b> Cost you need to pay for the product.
                </p>
                <p>
                    <b>Quality:</b> 1-3 star (<img class="symbol" src="{% static star_symbol %}" />) rating. Products
                    with more stars (<img class="symbol" src="{% static star_symbol %}" />) are more likely to have
                    higher quality.
                </p>
                <p>
                    <b>Eco-Label:</b> 1-3 leaf (<img class="symbol" src="{% static leaf_symbol %}" />) rating. Products
                    with more leaves (<img class="symbol" src="{% static leaf_symbol %}" />) are more likely
                    to be more sustainable.
                </p>
            </div>
        </div>

        <!-- Slide 5 -->
        <div class="mySlides">
            <div class="slide-item slide-item2">
                <p class="title"> Purchasing Platform </p>
                <div class="button-text-container">
                    <div class="text-container">
                        <p>
                            The product characteristics (Price, Quality and Eco-Label) for each product will be behind
                            <i>‘boxes’.</i>
                            <br><br>To reveal the
                            information, all you need to do is to move your mouse on top of the <i>‘box’</i> and the
                            information will be revealed. Here is
                            an example, <u>try moving your mouse on top of the box.</u>
                        </p>
                    </div>
                    <div class="button-container">
                        <p>
                            Hover me!
                        </p>
                        <button type="button" class="r1 mousy button-outcome hidden hover-button" id="b3">
                            Good job!
                        </button>
                        <p class="text-reveal" id="reveal">
                            See, it's easy? <br>You can now move to the next slide.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 6 -->
        <div class="mySlides">
            <div class="slide-item">
                <p class="title"> The Choice </p>
                <p>
                    Once you have analyzed the products, you can choose between one of them. Below the
                    characteristics, you will find one
                    button for each option. To choose one product, just click the corresponding button below.
                    <br><br>
                    If you didn't quite get it yet, don't worry!
                    <br> There will be <b>three practice trials</b> before the real experiment starts.
                </p>
            </div>
        </div>

        <!-- Slide 7 (Questions) -->
        <div class="mySlides">
            <!-- Question slide container-->
            <div class="flex-questions">
                <p class="title"> Is it all clear? Please answer these questions correctly to proceed:</p>
                <li>
                    <!--Question 1-->
                    <div class="inst-question">
                        <!-- Question-->
                        <label for="Q1">How many practice trials do you get?</label>
                    </div>
                    <div class="answer-field">
                        <!-- Input field -->
                        <input type="text" name="Q1" id="Q1" style="width: 9vw; height: 6vh">
                    </div>
                    <div class="hint" id="hint1">
                        <!-- Hint -->
                        Incorrect: see slide 6!
                        <div>
                </li>
                <li>
                    <!--Question 2-->
                    <div class="inst-question">
                        <label for="Q2"> What does the <img class="symbol" src="{% static star_symbol %}" /> stand for?</label>
                    </div>
                    <div class="answer-field">
                        <select name="Q2" id="Q2" class="dropdown">
                            <option value="nothing">--Select--</option>
                            <option value="a">User rating</option>
                            <option value="b">Quality</option>
                            <option value="c">Sustainability</option>
                        </select>
                    </div>
                    <div class="hint" id="hint2">
                        Incorrect: see slide 4!
                        <div>
                </li>
                <li>
                    <!--Question 3-->
                    <div class="inst-question">
                        <label for="Q3">Decisions in this experiment can ...</label>
                    </div>
                    <div class="answer-field">
                        <select name="Q3" id="Q3" class="dropdown">
                            <option value="nothing">--Select--</option>
                            <option value="a">earn you money</option>
                            <option value="b">help the environment</option>
                            <option value="c">both</option>
                        </select>
                    </div>
                    <div class="hint" id="hint3">
                        Incorrect: see slide 2!
                        <div>
                </li>
                <li>
                    <!-- Submit answers and Next button (next button appears when user answers all questions correctly)-->
                    <a id="submitAnswer" class="button" onclick=validateAnswers()>Submit
                    </a>
                    <button id="submit" class="button">Next</button>
                </li>
            </div>
        </div>

        <!-- Next and previous buttons -->
        <a id="leftArrow" class="prev" onclick="plusSlides(-1)">&#10094;</a>
        <a id="rightArrow" class="next" onclick="plusSlides(1)">&#10095;</a>

        <!-- The dots/circles (if you want to add extra slides, add span(s) here)-->
        <div class="dot_row">
            <span class="dot" onclick="currentSlide(1)"></span>
            <span class="dot" onclick="currentSlide(2)"></span>
            <span class="dot" onclick="currentSlide(3)"></span>
            <span class="dot" onclick="currentSlide(4)"></span>
            <span class="dot" onclick="currentSlide(5)"></span>
            <span class="dot" onclick="currentSlide(6)"></span>
            <span class="dot" onclick="currentSlide(7)"></span>
        </div>

    </div>

</body>

<!-- oTree templates -->
{% endblock %}


<!-- JAVASCRIPT -->

<script>

    // Initialize slide index //
    let slideIndex = 1;
    showSlides(slideIndex);

    // Next/previous controls: activate showSlides functions if arrows and arrow keys pressed. Stops the slides from going in "carousel" + slide 5 & 6 enabled after hovering a button on slide 4. 
    function plusSlides(n) {
        if (n === 1 && slideIndex === 5 && conditionSlide4 === false) {
            return;
        } else if (n === (-1) && slideIndex === 1) {
            return;
        } else if (n === 1 && slideIndex === 7) {
            return;
        } else {
            showSlides(slideIndex += n);
        }
    };

    // Thumbnail image controls (slide 5 & 6 enabled after hovering a button on slide 4)
    function currentSlide(n) {
        if (n === 6 && slideIndex <= 5 && conditionSlide4 === false) {
            return;
        } else if (n === 7 && slideIndex <= 5 && conditionSlide4 === false) {
            return;
        } else {
            showSlides(slideIndex = n);
        };
    };

    // User needs to hover over button on slide 4 to be able to go forward. Reveals text under button after hovering. 
    let conditionSlide4 = false;

    document.getElementById("b3").addEventListener("mouseover", (event) => {
        conditionSlide4 = true;
        document.getElementById("reveal").style.visibility = "visible";
    });

    // Next/previous keypress controls //
    document.addEventListener('keydown', (event) => {
        let keypress = event.key;
        if (keypress === 'ArrowLeft') {
            plusSlides(-1);
        } else if (keypress === 'ArrowRight') {
            plusSlides(1);
        }
    });

    // Slide switch function //
    function showSlides(n) {
        let i; // slide count
        let slides = document.getElementsByClassName("mySlides"); // get slides
        let dots = document.getElementsByClassName("dot"); // get dots
        let arrowLeft = document.querySelector("#leftArrow"); // get left arrow
        let arrowRight = document.querySelector("#rightArrow"); // get right arrow

        for (i = 0; i < slides.length; i++) { // hide slides by default
            slides[i].style.display = "none";
        }
        for (i = 0; i < dots.length; i++) { // change dot color based on dot count
            dots[i].className = dots[i].className.replace(" active", "");
        }
        slides[slideIndex - 1].style.display = "block"; // show slide
        dots[slideIndex - 1].className += " active"; // change dot color 

        if (n === 1) {
            arrowLeft.style.display = "none" // make left arrow invisible on 1st slide
        } else if (n > 1) {
            arrowLeft.style.display = "block"
        }

        if (n >= slides.length) {
            arrowRight.style.display = "none" // make right arrow invisible on 4th slide
        } else if (n < slides.length) {
            arrowRight.style.display = "block"
        }
    }

    // QUESTIONS SLIDE //

    // This function runs when "Submit" button is clicked. It compares all the inputs to question with solutions; if input is incorrect or empty, hint appears next to it. If the answer is correct, the function makes hint invisible again. If all inputs are correct, "Next" button will become visible. 

    let submitButton = document.getElementById("submitAnswer"); // get submit button
    let nextButton = document.getElementById("submit"); // get Next button

    nextButton.style.display = "none" // Hide Next button

    function validateAnswers() {

        let solutions = ['3', 'b', 'c']; // solutions
        let hints = document.getElementsByClassName("hint"); // make array of hints

        // get answer fields
        let A1 = document.getElementById("Q1");
        let A2 = document.getElementById("Q2");
        let A3 = document.getElementById("Q3");

        let answerList = [A1, A2, A3]; // create an array out of the answers
        let correct = 0; // initialize counter for correct answers

        for (i = 0; i < answerList.length; i++) { // iterate through answers
            if (answerList[i] !== null) { // check for empty fields
                answerList[i] = answerList[i].value; // get value if not empty
            }
            if (answerList[i] !== solutions[i] || answerList[i] === null) { // incorrect or empty field: show hint
                hints[i].style.visibility = "visible";
            } else {
                correct = correct + 1; // correct: increase counter, hide hint
                hints[i].style.visibility = "hidden";

            }
        }
        if (correct === answerList.length) { // if all correct, hide Submit button and show Next button
            submitButton.style.display = "none"
            nextButton.style.display = "block"
        }

    }

    document.addEventListener("DOMContentLoaded", function (debug = true) {
        InitializeVT(document.getElementsByClassName('otree-body')[0]);
        // Convert all buttons with the class 'clickable' into click VT buttons
        ConvertButtons2VT('clickable', sActivation = 'click');
        // Convert all buttons with the class 'mousy' into mouseover VT buttons
        ConvertButtons2VT('mousy', sActivation = 'mouseover');
        // Convert all buttons with the class 'row' into click VT buttons that activate outcome-buttons with the class 'r1'
        ConvertButtons2VT('row', sActivation = 'click', 'r1');
    });

    // ----------------------------------------------------- //

    // Time and Click variables
    var sPreviousPress = 'Start';
    var dPreviousTime = new Date().getTime();
    var now = new Date().getTime();
    var StartTime = new Date().getTime();
    var diff = 0;

    // ----------------------------------------------------- //



    // ----------------------------------------------------- //
    //  Function:       1. Creates inputs necessary for Visual Trace
    // 
    //  Inputs:
    //    - btn      : Target button, where evenlistener will be added 
    //    - sValue   : String, value
    // ----------------------------------------------------- //
    function InitializeVT(Body, sNameButtonClicks = 'sButtonClick', sNameTimeClicks = 'sTimeClick') {
        if (isEmpty(Body)) {
            Body = document.getElementsByTagName('body')[0];
        }
        // Create hidden input (Pressed Buttons)
        var sButtonClick = document.createElement("input");
        sButtonClick.type = 'hidden';
        sButtonClick.name = sNameButtonClicks;
        sButtonClick.id = sNameButtonClicks;
        sButtonClick.value = '';

        // Create hidden input (Time Buttons)
        var sTimeClick = document.createElement("input");
        sTimeClick.type = 'hidden';
        sTimeClick.name = sNameTimeClicks;
        sTimeClick.id = sNameTimeClicks;
        sTimeClick.value = '';

        // Append Inputs
        Body.appendChild(sButtonClick);
        Body.appendChild(sTimeClick);
    }


    // ----------------------------------------------------- //
    //  Function:       1.  scans all buttons with specific class 
    //                      and converts them to Visual-Tracing Buttons 
    //  Inputs:
    //    - sButtonClass      : class that encompases buttons to add event listener
    //    - sActivation       : Target button, where evenlistener will be added 
    //    - sDisplayClass     : string with classes that should be activated.
    //                          If empty, then activates itself
    //  Outputs:
    //    - vVT_Buttons : array with all buttons with Visual-Tracing certain visual tracing class
    // ----------------------------------------------------- /
    function ConvertButtons2VT(sButtonClass, sActivation = 'click', sDisplayClass) {
        vVT_Buttons = document.getElementsByClassName(sButtonClass);
        console.log(vVT_Buttons);
        for (let j = 0; j < vVT_Buttons.length; j++) {
            console.log('Added ' + sActivation + ' to activate ' + sDisplayClass);
            AddVisualTracer(vVT_Buttons[j], sActivation, sDisplayClass);
        };
        return vVT_Buttons;
    }

    // ----------------------------------------------------- //
    //  Function:       1. Looks at string value and detects form "img:Name"  
    //                  2. In case of image, replaces value for image Tag
    //                  3. Adds cleaned value to button 
    //  Inputs:
    //    - btn      : Target button, where evenlistener will be added 
    //    - sValue   : String, value
    // ----------------------------------------------------- //
    function CheckImage(btn, sValue) {
        // Check if Image:

        if (sValue.substring(0, 4) == 'img:') {
            //console.log(btn.id+' is image')
            let ButtonImage = document.createElement('img');
            ButtonImage.src = '/static/EcoLabels/' + sValue.substring(4);
            ButtonImage.className = 'button-img'
            btn.appendChild(ButtonImage);
            return
        } else {
            //console.log(btn.id+' is other')
            btn.innerHTML = sValue;
        }

    };
    // ----------------------------------------------------- //
    //  Function:      1. Checks is string is empty and/or undefined
    //  Inputs:
    //    - str      : Target button, where evenlistener will be added 
    //  Output: 
    //    - Boolean, true if element is empty and/or undefined
    // ----------------------------------------------------- //
    function isEmpty(str) {
        return (!str || str.length === 0);
    };

    // ----------------------------------------------------- //
    //  Function:       1. Adds OnClick or Mouseover/Mouseout  
    //                  2. Records Times and Clicks Accordingly
    //  Inputs:
    //    - btn             : Target button, where evenlistener will be added 
    //    - sActivation     : String, activation method for button
    //    - DisplayClass    : String, class combination that will be activated
    // ----------------------------------------------------- //

    function AddVisualTracer(btn, sActivation = 'click', sDisplayClass) {
        // add ID as a class
        btn.classList += ' ' + btn.id;
        // If there is no activation class, use self id. 
        if (isEmpty(sDisplayClass)) {
            sDisplayClass = btn.id;
        }

        if (sActivation == 'click') {
            // If click
            btn.addEventListener('click', function () {
                // Check it's not double click
                if (btn.id != sPreviousPress) {
                    // Record new time
                    now = new Date().getTime();
                    // display specific content and hide rest
                    HideEverything();
                    DisplayContent(sDisplayClass);
                    // record button pressed  
                    if (sButtonClick.value) {
                        sButtonClick.value = sButtonClick.value + ';' + btn.id;
                    } else {
                        sButtonClick.value = btn.id;
                    };
                    // change previous to new
                    sPreviousPress = btn.id;
                    //console.log(sButtonClick.value);

                    // Check if there was lost of focus
                    if (typeof bCheckFocus !== 'undefined' && bCheckFocus == true && TBlur >= dPreviousTime) {
                        // substract the blurred time
                        diff = (now - dPreviousTime) - (TFocus - TBlur);
                    } else {
                        diff = (now - dPreviousTime);
                    }
                    // Add Time
                    if (sTimeClick.value) {
                        sTimeClick.value = sTimeClick.value + ';' + diff;
                    } else {
                        sTimeClick.value = diff;
                    };
                    // Replace previous time
                    dPreviousTime = now;
                }
                //console.log(sTimeClick.value);  
            });

        } else if (sActivation == 'mouseover') {
            // mouseover
            btn.addEventListener('mouseover', function () {
                // Check that new element is pressed
                if (btn.id != sPreviousPress) {
                    // Record new time
                    dPreviousTime = new Date().getTime();
                    // display specific content and hide rest
                    HideEverything();
                    DisplayContent(sDisplayClass);

                    // record button pressed  
                    if (sButtonClick.value) {
                        sButtonClick.value = sButtonClick.value + ';' + btn.id;
                    } else {
                        sButtonClick.value = btn.id;
                    };
                    // change previous to new
                    sPreviousPress = btn.id;
                    //console.log(sButtonClick.value);
                }
            });
            // Mouseout
            btn.addEventListener('mouseout', function () {
                // Record Event Time
                now = new Date().getTime();
                // Hide the content & Reset previous item
                sPreviousPress = ' ';
                HideEverything();
                // Check if there is focus checks
                if (typeof bCheckFocus !== 'undefined' && bCheckFocus == true && TBlur >= dPreviousTime) {
                    // substract the blurred time
                    diff = (now - dPreviousTime) - (TFocus - TBlur);
                } else {
                    diff = (now - dPreviousTime);
                }
                // Add Time
                if (sTimeClick.value) {
                    sTimeClick.value = sTimeClick.value + ';' + diff;
                } else {
                    sTimeClick.value = diff;
                };
                //console.log(sTimeClick.value);  
            });
        } else {
            console.log('"' + sActivation + '"' + ' is not a valid Activation method')
        }

    };

    // ----------------------------------------------------- //
    //  Function:    Display Contents from a specific class  
    //  Inputs:
    //    - DisplayClass    : String, class combination that will be activated
    // ----------------------------------------------------- //

    function DisplayContent(DisplayClass) {
        let x = document.getElementsByClassName(DisplayClass);
        for (let i = 0; i < x.length; i++) {
            x[i].classList.remove('hidden');
            x[i].classList.add('non-hidden');
        }
    };

    // ----------------------------------------------------- //
    //  Function:     Hide all elements in the table  
    // ----------------------------------------------------- //

    function HideEverything() {
        let x = document.getElementsByClassName("button-outcome");
        // console.log(x);
        for (let i = 0; i < x.length; i++) {
            x[i].classList.remove('non-hidden');
            x[i].classList.add('hidden');
        }
    };
</script>