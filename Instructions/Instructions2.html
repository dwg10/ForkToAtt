<!-- INSTRUCTION PAGE -->

<!-- LINK TO STYLESHEET-->
<link rel="stylesheet" href="{% static 'global/styling.css' %}">
<link rel="stylesheet" href="{% static 'global/FriendlyChecks.css' %}">

<!-- Link to JS -->
<script src="{% static 'global/VT_functionality.js' %}"></script>
<script src="{% static 'global/FriendlyChecks.js' %}"></script>

<!-- Set viewport -->
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- oTree templates -->
{% load otree static %}
{% block content %}

<body>

    <!-- Slide container-->
    <div class="flex-container">

        <!-- Title -->
        <h1> Instructions </h1>

        <!-- Slide 1-->

        <!-- Hide slide by default-->
        <div class="mySlides">

            <!-- Style slide items-->
            <div class="slide-item">

                <!-- Slide title -->
                <p class="title"> The Experiment </p>
                    <ul>
                        <li> 
                            In this study you will make purchasing decisions. 
                        </li>
                        <li>
                            The products that you will observe are <b>not real</b>. 
                        </li>
                        <li>
                            There is no physical product, but your <u>decisions</u> will have <b>real consequences.</b>
                        </li>
                        <li>
                            Depending on your <u>decisions</u> you can an obtain additional <b>bonus payment up to €{{ Constants.MaxBonus }}</b> 
                            and help the environment by <b>planting trees in the Amazon</b>
                        </li>
                        <li> The donations will be done by {{ Constants.TreesOrg }}</li>
                    </ul>
            </div>
        </div>
        <!-- Slide 2-->
        <div class="mySlides">
            <div class="slide-item">
                <p class="title" > Your decisions </p>
                
                <div style="display: flex; flex-direction: row; width: 100%;">
                    <div class="slide-text" style="padding-right: 1em; width: 75%;"> 
                        In this experiment you will:
                        <ul>
                            <li> Make multiple purchasing decisions (<b>{{ Constants.NumTrials }} rounds</b>).</li>
                            <li> In each round, you will see <b>2 products</b> and their characteristics.</li>
                            <li> These products are not real, but their benefits are. </li>
                            <li> The next slide explains the benefits and characteristics of the products.</li>
                        </ul>
                    </div>
                    <div class="slide-figure" style="width: 20%;"> Here we need a screenshot of the decision table with all attributes visible </div> 
                </div>
            </div>
        </div>

        <!-- Slide 3-->
        <div class="mySlides">
            <div class="slide-item">
                <p class="title">The Product characteristics</p>
                <p>
                    The characteristics of the products you choose, will affect the benefits you get:
                </p>
                <ul>
                    <li>
                        <b>Price:</b> This is the cost you need to pay for the product. The price is in (pound symbol)
                    </li>
                    <p style="margin-left: 50px;font-size: 0.8em;">
                       Higher Price <span>&#8594;</span> lower bonus payments. 
                    </p>
                    <li> 
                        <b>Quality:</b> 1-3 star (<img class="symbol" src="{% static star_symbol %}" />) rating. Products
                        with more stars (<img class="symbol" src="{% static star_symbol %}" />) are more likely to have
                        higher quality.
                    </li>
                    <p style="margin-left: 50px;font-size: 0.8em;">
                        Higher quality  <span>&#8594;</span> higher bonus payments.
                    </p> 
                    <li>
                        <b>Eco-Label:</b> 1-3 leaf (<img class="symbol" src="{% static leaf_symbol %}" />) rating. Products
                        with more leaves (<img class="symbol" src="{% static leaf_symbol %}" />) are more likely
                        to be more sustainable.
                    </li>
                    <p style="margin-left: 50px;font-size: 0.8em;">
                        Higher sustainability <span>&#8594;</span> more trees planted in the Amazon. 
                    </p>
                </ul>

                
            </div>
        </div>

        <!-- Slide 4 -->
        <div class="mySlides">
            <div class="slide-item slide-item2">
                <p class="title"> Purchasing Platform </p>
                <div class="button-text-container">
                    <div class="text-container">
                        <p>
                            The product characteristics (Price, Quality and Sustainability) for each product will be behind
                            <i>‘boxes’.</i>
                        </p>
                        <p>
                            To reveal the information, all you need to do is to move your mouse on top of the <i>‘box’</i> and the
                            information will be revealed. Here is an example.
                        </p>
                        <p>
                            <b>Try moving your mouse on top of the box.</b>
                        </p>
                    </div>
                    <div class="button-container">
                        <p>
                            Hover me!
                        </p>
                        <button type="button" class="r1 mousy button-outcome hidden hover-button" id="b3">
                            Good job!
                        </button>
                        <p class="text-reveal" id="reveal">
                            See, it's easy? <br>You can now move to the next slide.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 5 -->
        <div class="mySlides">
            <div class="slide-item">
                <p class="title"> The Choice </p>
                <div style="display: flex; flex-direction: row; width: 100%;">
                    <div class="slide-text" style="padding-right: 1em; width: 75%;"> 
                        In this experiment you will:
                        <ul>
                            <li> Once you have analyzed the products, you can choose between one of them. </li>
                            <li> Below the characteristics, you will find one button for each option.</li>
                            <li> To choose one product, just click the corresponding button below. </li>
                            <li> If you didn't quite get it yet, don't worry! There will be <b>3 practice trials</b> before the real experiment starts. </li>
                            <li> At the end of the experiment, we will choose 1 of the rounds (randomly), and you will receive the benefits of that round.</li>
                        </ul>
                    </div>
                <div class="slide-figure" style="width: 20%;"> Here we screenshot of the decision page with the decision buttons rounded. </div> 
            </div>
        </div>
                
        <!-- Slide 6 (Questions) -->
        <div class="mySlides">
            <!-- Question slide container-->
            <div class="flex-questions">
                <p class="title"> Is it all clear? Please answer these questions correctly to proceed:</p>
                <li>
                    <!--Question 1-->
                    <div class="inst-question">
                        <!-- Question-->
                        <label for="Q1"> How many decisions will be chosen for payment? </label>
                    </div>
                    <div class="answer-field">
                        <!-- Input field -->
                        <input type="text" name="Q1" id="Q1" style="width: 9vw; height: 6vh">
                    </div>
                    <div class="hint" id="hint1">
                        <!-- Hint -->
                        Incorrect: see slide 5!
                        <div>
                </li>
                <li>
                    <!--Question 2-->
                    <div class="inst-question">
                        <label for="Q2"> What does the <img class="symbol" src="{% static star_symbol %}" /> stand for?</label>
                    </div>
                    <div class="answer-field">
                        <select name="Q2" id="Q2" class="dropdown">
                            <option value="nothing">--Select--</option>
                            <option value="a">User rating</option>
                            <option value="b">Quality</option>
                            <option value="c">Sustainability</option>
                        </select>
                    </div>
                    <div class="hint" id="hint2">
                        Incorrect: see slide 4!
                        <div>
                </li>
                <li>
                    <!--Question 3-->
                    <div class="inst-question">
                        <label for="Q3">Decisions in this experiment can ...</label>
                    </div>
                    <div class="answer-field">
                        <select name="Q3" id="Q3" class="dropdown">
                            <option value="nothing">--Select--</option>
                            <option value="a">earn you money</option>
                            <option value="b">help the environment</option>
                            <option value="c">both</option>
                        </select>
                    </div>
                    <div class="hint" id="hint3">
                        Incorrect: see slide 2!
                        <div>
                </li>
                <li>
                    <!-- Submit answers and Next button (next button appears when user answers all questions correctly)-->
                    <a id="submitAnswer" class="button" onclick=validateAnswers()>Submit
                    </a>
                    <button id="submit" class="button">Next</button>
                </li>
            </div>
        </div>

        <!-- Next and previous buttons -->
        <a id="leftArrow" class="prev" onclick="plusSlides(-1)">&#10094;</a>
        <a id="rightArrow" class="next" onclick="plusSlides(1)">&#10095;</a>

        <!-- The dots/circles (if you want to add extra slides, add span(s) here)-->
        <div class="dot_row">
            <span class="dot" onclick="currentSlide(1)"></span>
            <span class="dot" onclick="currentSlide(2)"></span>
            <span class="dot" onclick="currentSlide(3)"></span>
            <span class="dot" onclick="currentSlide(4)"></span>
            <span class="dot" onclick="currentSlide(5)"></span>
            <span class="dot" onclick="currentSlide(6)"></span>
        </div>

    </div>

</body>

<!-- oTree templates -->
{% endblock %}

<script>
    
        // Initialize slide index //
        let slideIndex = 1;
        showSlides(slideIndex);


        // Next/previous controls: activate showSlides functions if arrows and arrow keys pressed. Stops the slides from going in "carousel" + slide 5 & 6 enabled after hovering a button on slide 4. 
        function plusSlides(n) {
            if (n === 1 && slideIndex === 4 && conditionSlide4 === false) {
                return;
            } else if (n === (-1) && slideIndex === 1) {
                return;
            } else if (n === 1 && slideIndex === 6) {
                return;
            } else {
                showSlides(slideIndex += n);
            }
        };

        // Thumbnail image controls (slide 5 & 6 enabled after hovering a button on slide 4)
        function currentSlide(n) {
            if (n === 5 && slideIndex <= 4 && conditionSlide4 === false) {
                return;
            } else if (n === 6 && slideIndex <= 4 && conditionSlide4 === false) {
                return;
            } else {
                showSlides(slideIndex = n);
            };
        };

        // User needs to hover over button on slide 4 to be able to go forward. Reveals text under button after hovering. 
        let conditionSlide4 = false;

        document.getElementById("b3").addEventListener("mouseover", (event) => {
            conditionSlide4 = true;
            document.getElementById("reveal").style.visibility = "visible";
        });

        // Next/previous keypress controls //
        document.addEventListener('keydown', (event) => {
            let keypress = event.key;
            if (keypress === 'ArrowLeft') {
                plusSlides(-1);
            } else if (keypress === 'ArrowRight') {
                plusSlides(1);
            }
        });

        // Slide switch function //
        function showSlides(n) {
            let i; // slide count
            let slides = document.getElementsByClassName("mySlides"); // get slides
            let dots = document.getElementsByClassName("dot"); // get dots
            let arrowLeft = document.querySelector("#leftArrow"); // get left arrow
            let arrowRight = document.querySelector("#rightArrow"); // get right arrow

            for (i = 0; i < slides.length; i++) { // hide slides by default
                slides[i].style.display = "none";
            }
            for (i = 0; i < dots.length; i++) { // change dot color based on dot count
                dots[i].className = dots[i].className.replace(" active", "");
            }
            slides[slideIndex - 1].style.display = "block"; // show slide
            dots[slideIndex - 1].className += " active"; // change dot color 

            if (n === 1) {
                arrowLeft.style.display = "none" // make left arrow invisible on 1st slide
            } else if (n > 1) {
                arrowLeft.style.display = "block"
            }

            if (n >= slides.length) {
                arrowRight.style.display = "none" // make right arrow invisible on 6th slide
            } else if (n < slides.length) {
                arrowRight.style.display = "block"
            }
        }

        // QUESTIONS SLIDE //

        // This function runs when "Submit" button is clicked. It compares all the inputs to question with solutions; if input is incorrect or empty, hint appears next to it. If the answer is correct, the function makes hint invisible again. If all inputs are correct, "Next" button will become visible. 

        let submitButton = document.getElementById("submitAnswer"); // get submit button
        let nextButton = document.getElementById("submit"); // get Next button

        nextButton.style.display = "none" // Hide Next button

        function validateAnswers() {

            let solutions = ['1', 'b', 'c']; // solutions
            let hints = document.getElementsByClassName("hint"); // make array of hints

            // get answer fields
            let A1 = document.getElementById("Q1");
            let A2 = document.getElementById("Q2");
            let A3 = document.getElementById("Q3");

            let answerList = [A1, A2, A3]; // create an array out of the answers
            let correct = 0; // initialize counter for correct answers

            for (i = 0; i < answerList.length; i++) { // iterate through answers
                if (answerList[i] !== null) { // check for empty fields
                    answerList[i] = answerList[i].value; // get value if not empty
                }
                if (answerList[i] !== solutions[i] || answerList[i] === null) { // incorrect or empty field: show hint
                    hints[i].style.visibility = "visible";
                } else {
                    correct = correct + 1; // correct: increase counter, hide hint
                    hints[i].style.visibility = "hidden";

                }
            }
            if (correct === answerList.length) { // if all correct, hide Submit button and show Next button
                submitButton.style.display = "none"
                nextButton.style.display = "block"
            }

        }

        // For the hover button on slide 4
        document.addEventListener("DOMContentLoaded", function (debug = true) {
            InitializeVT(document.getElementsByClassName('otree-body')[0]);
            // Convert all buttons with the class 'mousy' into mouseover VT buttons
            ConvertButtons2VT('mousy', sActivation = 'mouseover');
        });

</script>